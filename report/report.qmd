---
execute:
  eval: true
  echo: false
  output: true
  freeze: false
---

<!-- report.qmd -->

```{=typst}
#title-page(
  [The Impact of Post-2024 Federal Income Tax Changes on Hospital Workers in New York],
  [Prepared for the Greater New York Hospital Association],
  [Don Boyd],
  [Boyd Research, LLC]
)
#toc-page()
#set page(columns: 2)
```

```{=typst}
// #set paralign(left)
#set par(linebreaks: "optimized")

```

# Introduction

Important changes in federal income taxes are scheduled for 2025 and later years. This report examines the major changes and how they will affect representative hospital workers in New York, in the 2025, 2026, and 2027 tax years. It presents impacts relative to the 2024 tax year.


```{r}
#| label: setup
#| output: false

GROOT <- rprojroot::find_root(rprojroot::has_file(".git/index"))
# source(fs::path(GROOT, "R", "libraries.R"))

tprint <- 75 # default tibble print
options(tibble.print_max = tprint, tibble.print_min = tprint)

libs <- function() {
  library(tidyverse)
  library(gt)
  library(tinytable)
  library(readxl)
}

libs()

```

Comparisons are to 2024 law, NOT to otherwise scheduled law. For example, ...

# Federal tax changes that will affect hospital workers

This project considers all important changes in federal income taxes. The most significant changes were passed by Congress in [month, ]2025 in legislation officially called the One Big Beautiful Bill Act (OBBBA). Among other things, OBBBA:

-  Extends tax reductions enacted in the Tax Cuts and Jobs Act of 2017 (TCJA) that had been scheduled to expire. While these have often been described as new tax reductions, they are largely continuations of existing law and for this report they are not treated as new reductions.
-  Modified the itemized deduction for state and local taxes (SALT), which had been capped at $10,000 in the TCJA. The cap had been schedule to expire in [year] but OBBBA increased the cap to $40,000 and extended it through [year].
-  Broadened and extended
-  Made other changes to the standard deduction, certain tax credits, and other provisions.

This section explains the major changes in OBBBA, and in other legislation as appropriate.

Explain changes here

Summary table in appendix.

# Representative hospital workers

How we design representative workers -- factors we need to consider (give example for each)

-  Hospital-related wages
-  Overtime income, if any
-  Other income
-  Income of spouse, if any, and other family members -- tax rates, tax brackets, eligibility for credits
-  Family structure
-  Region of the state - affects wages, different COLs; affects likelihood of owning a home, value of home, property taxes
-  Number of children and their ages

How we construct representative workers. Goal: realistic, but not overwhelming

Listing / summary of representative workers:

-  characteristics
-  regions
-  number of rep workers

See appendix for full details.

# How we calculate taxes

 Assistance of the Policy Simulation Libraryâ€™s Tax-Calculator model, a highly regarded model of the federal income tax -- [documentation](https://taxcalc.pslmodels.org/) and [code](https://github.com/PSLmodels/Tax-Calculator).

 Explain why this is a high-quality approach.


```{=typst}
#pagebreak()
#set page(
  flipped: true,
  columns: 1
)
```

```{=typst}
#include "taxchanges_table.typ"
```

```{=typst}
#pagebreak()
#set page(
  flipped: false,
  columns: 2
)
```

# Results

```{=typst}
#lorem(80)
#parbreak()
// other spacing options: #v(1em) #v(2em) #space(height: 12pt)
```

```{=typst}
#lorem(80)
#parbreak()
#lorem(80)
#parbreak()

// other spacing options: #v(1em) #v(2em) #space(height: 12pt)
```

# Conclusion

```{=typst}
#lorem(80)
#parbreak()
// other spacing options: #v(1em) #v(2em) #space(height: 12pt)
```

<!-- Place bibliography on new page after the conclusion. -->

```{=typst}
// harvard-cite-them-right, ieee, apa
#pagebreak()
#set page(columns: 1)
#bibliography("references.bib", title: "References", style: "harvard-cite-them-right", full: true)
```

```{=typst}
#pagebreak()
```

# Appendices

## Representative households

```{r}
#| label: get-tax-change-table-data
#| eval: false

fname <- "GNYHA report inputs.xlsx"
fpath <- fs::path(GROOT, "data", fname)
df <- read_excel(fpath, sheet = "tax changes", range = cell_cols("A:F"))

df2 <- df |>
  filter(row_number() > 3)

df3 <- df2 |>
  filter(!is.na(item), !is.na(y2024)) |>
  select(-notes)

attr(df3$item, "label") <- "Tax law provision"
attr(df3$y2024, "label") <- "2024 actual"
attr(df3$y2025, "label") <- "2025"
attr(df3$y2026, "label") <- "2026"
attr(df3$y2027, "label") <- "2027"

fpath <- fs::path(GROOT, "data", "table.csv")

df3 |>
  write_csv(fpath, quote = "all")

```


```{r}
#| echo: false
knitr::knit_exit()
```


## Examples of typst techniques

```{=typst}
#pagebreak()
#set page(
  flipped: true,
  columns: 1
)
```

```{r}
#| label: tax-changes-table
#| output: true

col1width <- .1
colwidths <- c(col1width, rep((1 - col1width) / 4, 4))

taxtable <- df3 |>
  tt(
    output = "typst",
    escape = TRUE,
    width = colwidths,
    colnames = "label",
    caption = "Important tax changes, relative to 2024 law, that will affect hospital workers"
  ) |>
  style_tt("caption", smallcap = TRUE, bold = TRUE, fontsize = 1.5) |>
  style_tt("colnames", italic = TRUE, bold = TRUE) |>
  style_tt(j = 1:5, align = "l") |>
  format_tt(replace = TRUE) |>
  group_tt(
    j = list(
      "Scheduled law" = 3:5
    )
  ) |>
  style_tt(i = -1, j = 3:5, background = "grey95", bold = TRUE)

fpath <- fs::path(GROOT, "report", "taxlaw_table.png")
# save_tt(taxtable, output = fpath, overwrite = TRUE)
# save_tt(taxtable, output = "taxlaw_table.pdf")

```

```{=typst}
#pagebreak()
#set page(
  flipped: false,
  columns: 2
)
```
